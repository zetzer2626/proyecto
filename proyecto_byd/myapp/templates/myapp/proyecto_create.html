{% extends 'base.html' %}

{% block title %}
    {% if object %}Editar Proyecto{% else %}Nuevo Proyecto{% endif %} - Sistema de Gestión
{% endblock %}

{% block page_title %}
    {% if object %}Editar Proyecto{% else %}Nuevo Proyecto{% endif %}
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title">
                <i class="fas fa-{% if object %}edit{% else %}plus{% endif %} me-2"></i>
                {% if object %}Editar Proyecto{% else %}Nuevo Proyecto{% endif %}
            </h1>
            <p class="page-subtitle">
                {% if object %}
                    Modifica la información del proyecto: {{ object.nombre }}
                {% else %}
                    Completa la información para crear un nuevo proyecto
                {% endif %}
            </p>
        </div>
        <div>
            <a href="{% url 'proyecto-list' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Volver a Lista
            </a>
        </div>
    </div>
</div>

<form method="post" enctype="multipart/form-data" id="proyectoForm">
    {% csrf_token %}
    
    <div class="row">
        <!-- Información Básica -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-info-circle me-2"></i>Información Básica
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.presupuesto.id_for_label }}" class="form-label">
                                    <i class="fas fa-dollar-sign me-1"></i>Presupuesto
                                </label>
                                {{ form.presupuesto }}
                                {% if form.presupuesto.errors %}
                                    <div class="text-danger small mt-1">{{ form.presupuesto.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.año.id_for_label }}" class="form-label">
                                    <i class="fas fa-calendar me-1"></i>Año
                                </label>
                                {{ form.año }}
                                {% if form.año.errors %}
                                    <div class="text-danger small mt-1">{{ form.año.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.nombre.id_for_label }}" class="form-label required">
                                    <i class="fas fa-user me-1"></i>Nombre del Cliente
                                </label>
                                {{ form.nombre }}
                                {% if form.nombre.errors %}
                                    <div class="text-danger small mt-1">{{ form.nombre.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.telefono.id_for_label }}" class="form-label">
                                    <i class="fas fa-phone me-1"></i>Teléfono
                                </label>
                                {{ form.telefono }}
                                {% if form.telefono.errors %}
                                    <div class="text-danger small mt-1">{{ form.telefono.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.correo.id_for_label }}" class="form-label">
                                    <i class="fas fa-envelope me-1"></i>Correo Electrónico
                                </label>
                                {{ form.correo }}
                                {% if form.correo.errors %}
                                    <div class="text-danger small mt-1">{{ form.correo.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.rol_avaluo.id_for_label }}" class="form-label">
                                    <i class="fas fa-file-alt me-1"></i>Rol Avalúo
                                </label>
                                {{ form.rol_avaluo }}
                                {% if form.rol_avaluo.errors %}
                                    <div class="text-danger small mt-1">{{ form.rol_avaluo.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.direccion.id_for_label }}" class="form-label">
                            <i class="fas fa-map-marker-alt me-1"></i>Dirección
                        </label>
                        {{ form.direccion }}
                        {% if form.direccion.errors %}
                            <div class="text-danger small mt-1">{{ form.direccion.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.proyecto.id_for_label }}" class="form-label">
                            <i class="fas fa-project-diagram me-1"></i>Descripción del Proyecto
                        </label>
                        {{ form.proyecto }}
                        {% if form.proyecto.errors %}
                            <div class="text-danger small mt-1">{{ form.proyecto.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Estado y Proceso -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-tasks me-2"></i>Estado y Proceso
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.estado_proyecto.id_for_label }}" class="form-label">
                                    <i class="fas fa-flag me-1"></i>Estado del Proyecto
                                </label>
                                {{ form.estado_proyecto }}
                                {% if form.estado_proyecto.errors %}
                                    <div class="text-danger small mt-1">{{ form.estado_proyecto.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.proceso.id_for_label }}" class="form-label">
                                    <i class="fas fa-cog me-1"></i>Proceso
                                </label>
                                {{ form.proceso }}
                                {% if form.proceso.errors %}
                                    <div class="text-danger small mt-1">{{ form.proceso.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.kardex.id_for_label }}" class="form-label">
                            <i class="fas fa-clipboard me-1"></i>Kardex
                        </label>
                        {{ form.kardex }}
                        {% if form.kardex.errors %}
                            <div class="text-danger small mt-1">{{ form.kardex.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.detalle.id_for_label }}" class="form-label">
                                    <i class="fas fa-align-left me-1"></i>Detalle
                                </label>
                                {{ form.detalle }}
                                {% if form.detalle.errors %}
                                    <div class="text-danger small mt-1">{{ form.detalle.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.descripcion.id_for_label }}" class="form-label">
                                    <i class="fas fa-file-text me-1"></i>Descripción
                                </label>
                                {{ form.descripcion }}
                                {% if form.descripcion.errors %}
                                    <div class="text-danger small mt-1">{{ form.descripcion.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Panel Lateral -->
        <div class="col-lg-4">
            <!-- Progreso del Proyecto -->
            {% if object %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-pie me-2"></i>Progreso del Proyecto
                    </h5>
                </div>
                <div class="card-body text-center">
                    {% with completitud=object.calcular_porcentaje_completitud %}
                        <div class="mb-3">
                            <div class="progress mx-auto" style="width: 120px; height: 120px; border-radius: 50%; position: relative;">
                                <div class="progress-bar" style="width: {{ completitud }}%"></div>
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; font-weight: bold;">
                                    {{ completitud|floatformat:0 }}%
                                </div>
                            </div>
                        </div>
                        <p class="text-muted mb-0">Documentos Completados</p>
                        <small class="text-muted">{{ completitud|floatformat:0 }}% de 16 documentos</small>
                    {% endwith %}
                </div>
            </div>
            {% endif %}
            
            <!-- Enlaces y Presupuesto -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-link me-2"></i>Enlaces y Documentos
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="{{ form.link_1.id_for_label }}" class="form-label">
                            <i class="fas fa-cloud me-1"></i>Enlace OneDrive
                        </label>
                        {{ form.link_1 }}
                        {% if form.link_1.errors %}
                            <div class="text-danger small mt-1">{{ form.link_1.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.nombre_enlace_1.id_for_label }}" class="form-label">
                            <i class="fas fa-tag me-1"></i>Nombre del Enlace
                        </label>
                        {{ form.nombre_enlace_1 }}
                        {% if form.nombre_enlace_1.errors %}
                            <div class="text-danger small mt-1">{{ form.nombre_enlace_1.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.presupuesto_link.id_for_label }}" class="form-label">
                            <i class="fas fa-calculator me-1"></i>Enlace Presupuesto
                        </label>
                        {{ form.presupuesto_link }}
                        {% if form.presupuesto_link.errors %}
                            <div class="text-danger small mt-1">{{ form.presupuesto_link.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.enlace_documento.id_for_label }}" class="form-label">
                            <i class="fas fa-file-pdf me-1"></i>Enlace Documento
                        </label>
                        {{ form.enlace_documento }}
                        {% if form.enlace_documento.errors %}
                            <div class="text-danger small mt-1">{{ form.enlace_documento.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Acciones -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-cogs me-2"></i>Acciones
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            {% if object %}Actualizar Proyecto{% else %}Crear Proyecto{% endif %}
                        </button>
                        {% if object %}
                            <a href="{% url 'proyecto-detail' object.pk %}" class="btn btn-outline-info">
                                <i class="fas fa-eye me-2"></i>Ver Detalles
                            </a>
                        {% endif %}
                        <a href="{% url 'proyecto-list' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-2"></i>Cancelar
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Documentos Principales -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-folder me-2"></i>Documentos Principales
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.levantamiento.id_for_label }}" class="form-label">
                            <i class="fas fa-file-upload me-1"></i>Levantamiento
                        </label>
                        {{ form.levantamiento }}
                        {% if form.levantamiento.errors %}
                            <div class="text-danger small mt-1">{{ form.levantamiento.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.escritura.id_for_label }}" class="form-label">
                            <i class="fas fa-file-contract me-1"></i>Escritura
                        </label>
                        {{ form.escritura }}
                        {% if form.escritura.errors %}
                            <div class="text-danger small mt-1">{{ form.escritura.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.dominio_vigente.id_for_label }}" class="form-label">
                            <i class="fas fa-certificate me-1"></i>Dominio Vigente
                        </label>
                        {{ form.dominio_vigente }}
                        {% if form.dominio_vigente.errors %}
                            <div class="text-danger small mt-1">{{ form.dominio_vigente.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.cedula_identidad.id_for_label }}" class="form-label">
                            <i class="fas fa-id-card me-1"></i>Cédula de Identidad
                        </label>
                        {{ form.cedula_identidad }}
                        {% if form.cedula_identidad.errors %}
                            <div class="text-danger small mt-1">{{ form.cedula_identidad.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.poder.id_for_label }}" class="form-label">
                            <i class="fas fa-handshake me-1"></i>Poder
                        </label>
                        {{ form.poder }}
                        {% if form.poder.errors %}
                            <div class="text-danger small mt-1">{{ form.poder.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.rol_avaluo_detallado.id_for_label }}" class="form-label">
                            <i class="fas fa-file-alt me-1"></i>Rol Avalúo Detallado
                        </label>
                        {{ form.rol_avaluo_detallado }}
                        {% if form.rol_avaluo_detallado.errors %}
                            <div class="text-danger small mt-1">{{ form.rol_avaluo_detallado.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Servicios Básicos -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-lightbulb me-2"></i>Servicios Básicos
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.boleta_agua.id_for_label }}" class="form-label">
                            <i class="fas fa-tint me-1"></i>Boleta de Agua
                        </label>
                        {{ form.boleta_agua }}
                        {% if form.boleta_agua.errors %}
                            <div class="text-danger small mt-1">{{ form.boleta_agua.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.boleta_luz.id_for_label }}" class="form-label">
                            <i class="fas fa-bolt me-1"></i>Boleta de Luz
                        </label>
                        {{ form.boleta_luz }}
                        {% if form.boleta_luz.errors %}
                            <div class="text-danger small mt-1">{{ form.boleta_luz.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Documentos Adicionales -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-folder-plus me-2"></i>Documentos Adicionales
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.proyecto_anterior.id_for_label }}" class="form-label">
                            <i class="fas fa-history me-1"></i>Proyecto Anterior
                        </label>
                        {{ form.proyecto_anterior }}
                        {% if form.proyecto_anterior.errors %}
                            <div class="text-danger small mt-1">{{ form.proyecto_anterior.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.conjunto_habitacional.id_for_label }}" class="form-label">
                            <i class="fas fa-building me-1"></i>Conjunto Habitacional
                        </label>
                        {{ form.conjunto_habitacional }}
                        {% if form.conjunto_habitacional.errors %}
                            <div class="text-danger small mt-1">{{ form.conjunto_habitacional.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.informe_previo.id_for_label }}" class="form-label">
                            <i class="fas fa-file-medical me-1"></i>Informe Previo
                        </label>
                        {{ form.informe_previo }}
                        {% if form.informe_previo.errors %}
                            <div class="text-danger small mt-1">{{ form.informe_previo.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.utilidad_publica.id_for_label }}" class="form-label">
                            <i class="fas fa-landmark me-1"></i>Utilidad Pública
                        </label>
                        {{ form.utilidad_publica }}
                        {% if form.utilidad_publica.errors %}
                            <div class="text-danger small mt-1">{{ form.utilidad_publica.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.certificado_numero.id_for_label }}" class="form-label">
                            <i class="fas fa-award me-1"></i>Certificado Número
                        </label>
                        {{ form.certificado_numero }}
                        {% if form.certificado_numero.errors %}
                            <div class="text-danger small mt-1">{{ form.certificado_numero.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="{{ form.factibilidad.id_for_label }}" class="form-label">
                            <i class="fas fa-check-circle me-1"></i>Factibilidad
                        </label>
                        {{ form.factibilidad }}
                        {% if form.factibilidad.errors %}
                            <div class="text-danger small mt-1">{{ form.factibilidad.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.seim.id_for_label }}" class="form-label">
                            <i class="fas fa-map me-1"></i>SEIM
                        </label>
                        {{ form.seim }}
                        {% if form.seim.errors %}
                            <div class="text-danger small mt-1">{{ form.seim.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.listado.id_for_label }}" class="form-label">
                            <i class="fas fa-list me-1"></i>Listado
                        </label>
                        {{ form.listado }}
                        {% if form.listado.errors %}
                            <div class="text-danger small mt-1">{{ form.listado.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Documentos Opcionales -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-paperclip me-2"></i>Documentos Opcionales
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_1.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 1
                        </label>
                        {{ form.opcional_1 }}
                        {% if form.opcional_1.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_1.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_2.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 2
                        </label>
                        {{ form.opcional_2 }}
                        {% if form.opcional_2.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_2.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_3.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 3
                        </label>
                        {{ form.opcional_3 }}
                        {% if form.opcional_3.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_3.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_4.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 4
                        </label>
                        {{ form.opcional_4 }}
                        {% if form.opcional_4.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_4.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_5.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 5
                        </label>
                        {{ form.opcional_5 }}
                        {% if form.opcional_5.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_5.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_6.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 6
                        </label>
                        {{ form.opcional_6 }}
                        {% if form.opcional_6.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_6.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_7.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 7
                        </label>
                        {{ form.opcional_7 }}
                        {% if form.opcional_7.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_7.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_8.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 8
                        </label>
                        {{ form.opcional_8 }}
                        {% if form.opcional_8.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_8.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_9.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 9
                        </label>
                        {{ form.opcional_9 }}
                        {% if form.opcional_9.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_9.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.opcional_10.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Opcional 10
                        </label>
                        {{ form.opcional_10 }}
                        {% if form.opcional_10.errors %}
                            <div class="text-danger small mt-1">{{ form.opcional_10.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-save functionality (optional)
    let saveTimeout;
    document.getElementById('proyectoForm').addEventListener('input', function() {
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(function() {
            // You can implement auto-save here if needed
            console.log('Form data changed');
        }, 2000);
    });
    
    // Form validation
    document.getElementById('proyectoForm').addEventListener('submit', function(e) {
        const requiredFields = this.querySelectorAll('[required]');
        let hasErrors = false;
        
        requiredFields.forEach(function(field) {
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                hasErrors = true;
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        if (hasErrors) {
            e.preventDefault();
            alert('Por favor, complete todos los campos requeridos.');
        }
    });
    
    // File upload preview
    document.querySelectorAll('input[type="file"]').forEach(function(input) {
        input.addEventListener('change', function() {
            const fileName = this.files[0] ? this.files[0].name : 'Ningún archivo seleccionado';
            const label = this.closest('.mb-3').querySelector('label');
            if (this.files[0]) {
                label.innerHTML = label.innerHTML.replace(/(<i[^>]*><\/i>\s*)(.*)/, '$1' + fileName);
            }
        });
    });
</script>
{% endblock %}