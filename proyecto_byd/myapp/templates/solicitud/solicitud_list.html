{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Gestión de Solicitudes{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 text-dark fw-bold mb-1">Gestión de Solicitudes</h1>
                    <p class="text-muted mb-0">Administra y supervisa todas las solicitudes de documentos</p>
                </div>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-primary d-flex align-items-center gap-2" data-bs-toggle="modal" data-bs-target="#createSolicitudModal">
                        <i class="fas fa-plus"></i>
                        <span>Nueva Solicitud</span>
                    </button>
                    <button class="btn btn-outline-success d-flex align-items-center gap-2">
                        <i class="fas fa-file-excel"></i>
                        <span>Exportar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-3 mb-4">
        <!-- Completados -->
        <div class="col-6 col-md-4">
            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #059669 0%, #10b981 100%);">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="bg-white bg-opacity-25 rounded-circle p-3">
                                <i class="fa-solid fa-check-circle text-white fa-lg"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="text-white mb-1 fw-semibold">Completados</h6>
                            <h3 class="text-white mb-0 fw-bold">{{ completados_count }}</h3>
                            <small class="text-white">Solicitudes</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- En Proceso -->
        <div class="col-6 col-md-4">
            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="bg-white bg-opacity-25 rounded-circle p-3">
                                <i class="fa-solid fa-spinner text-white fa-lg"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="text-white mb-1 fw-semibold">En Proceso</h6>
                            <h3 class="text-white mb-0 fw-bold">{{ en_proceso_count }}</h3>
                            <small class="text-white">Solicitudes</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pendientes -->
        <div class="col-12 col-md-4">
            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="bg-white bg-opacity-25 rounded-circle p-3">
                                <i class="fa-solid fa-exclamation-circle text-white fa-lg"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="text-white mb-1 fw-semibold">Pendientes</h6>
                            <h3 class="text-white mb-0 fw-bold">{{ pendientes_count }}</h3>
                            <small class="text-white">Solicitudes</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filters Section -->
    <div class="filters-container mb-4">
        <div class="filters-card">
            <div class="filters-header">
                <div class="filters-title">
                    <button id="btnToggleFilters" class="btn btn-link text-white p-0 me-2" style="border: none; background: none;">
                        <i class="fas fa-chevron-down" id="iconToggleFilters"></i>
                    </button>
                    <div class="title-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="title-content">
                        <h4 class="title-text">Filtros de Búsqueda</h4>
                        <p class="title-subtitle">Refina tus resultados con filtros avanzados</p>
                    </div>
                </div>
                <div class="filters-actions">
                    <div class="active-filters">
                        <span class="filter-count">2</span>
                        <span class="filter-status-label">filtros activos</span>
                    </div>
                </div>
            </div>
            
            <div class="filters-body" id="filtersBody" style="display: none;">
                <form method="get" class="filters-form">
                    {% csrf_token %}
                    <div class="filters-grid">
                        <!-- Campo de búsqueda principal -->
                        <div class="filter-item search-filter">
                            <div class="filter-input-wrapper">
                                <div class="input-icon">
                                    <i class="fas fa-search"></i>
                                </div>
                                <input 
                                    type="text" 
                                    id="search" 
                                    name="q" 
                                    class="filter-input search-input" 
                                    placeholder="Buscar solicitante, nombre, dirección..." 
                                    value="{{ query }}">
                                <div class="input-focus-border"></div>
                            </div>
                        </div>

                        <!-- Filtro por estado -->
                        <div class="filter-item">
                            <label class="filter-label">Estado</label>
                            <div class="filter-input-wrapper">
                                <div class="input-icon">
                                    <i class="fas fa-flag"></i>
                                </div>
                                <select id="estado" name="estado" class="filter-input">
                                    <option value="">Todos los Estados</option>
                                    <option value="completado" {% if estado == "completado" %}selected{% endif %}>Completado</option>
                                    <option value="en_proceso" {% if estado == "en_proceso" %}selected{% endif %}>En Proceso</option>
                                    <option value="pendiente" {% if estado == "pendiente" %}selected{% endif %}>Pendiente</option>
                                </select>
                                <div class="input-focus-border"></div>
                            </div>
                        </div>

                        <!-- Filtro por fecha desde -->
                        <div class="filter-item">
                            <label class="filter-label">Fecha Desde</label>
                            <div class="filter-input-wrapper">
                                <div class="input-icon">
                                    <i class="fas fa-calendar"></i>
                                </div>
                                <input 
                                    type="date" 
                                    id="fecha_desde" 
                                    name="fecha_desde" 
                                    class="filter-input" 
                                    value="{{ request.GET.fecha_desde }}">
                                <div class="input-focus-border"></div>
                            </div>
                        </div>

                        <!-- Filtro por fecha hasta -->
                        <div class="filter-item">
                            <label class="filter-label">Fecha Hasta</label>
                            <div class="filter-input-wrapper">
                                <div class="input-icon">
                                    <i class="fas fa-calendar"></i>
                                </div>
                                <input 
                                    type="date" 
                                    id="fecha_hasta" 
                                    name="fecha_hasta" 
                                    class="filter-input" 
                                    value="{{ request.GET.fecha_hasta }}">
                                <div class="input-focus-border"></div>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="filter-item actions-filter">
                            <div class="filter-actions">
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-search"></i>
                                    <span>Buscar</span>
                                </button>
                                <a href="{% url 'solicitud-list' %}" class="btn-secondary">
                                    <i class="fas fa-undo"></i>
                                    <span>Limpiar</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Solicitudes Table Section -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 py-3">
            <h5 class="mb-0 text-dark fw-semibold">
                <i class="fas fa-table me-2 text-primary"></i>
                Lista de Solicitudes
            </h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table id="example" class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 120px;">Solicitante</th>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 130px;">Documentos</th>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 120px;">Nombre</th>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 120px;">Dirección</th>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 110px;">F. Solicitud</th>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 110px;">F. Recepción</th>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 150px;">Descripción</th>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 90px;">Drive</th>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 100px;">Estado</th>
                            <th class="border-0 fw-semibold text-dark" style="min-width: 120px;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for solicitud in solicitudes %}
                        <tr class="border-bottom">
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="avatar me-3">
                                        <div class="avatar-initial rounded-circle" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                            <span class="text-white fw-bold">{{ solicitud.solicitante|first|upper }}</span>
                                        </div>
                                    </div>
                                    <div>
                                        <span class="fw-bold text-dark">{{ solicitud.solicitante }}</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="badge rounded-pill" style="background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);">
                                    {{ solicitud.nombre_documento }}
                                </span>
                            </td>
                            <td>
                                <span class="fw-medium text-dark">{{ solicitud.nombre }}</span>
                            </td>
                            <td>
                                <span class="text-dark">{{ solicitud.direccion }}</span>
                            </td>
                            <td class="text-center">
                                {% if solicitud.fecha_solicitud %}
                                    <span class="badge rounded-pill" style="background: linear-gradient(135deg, #059669 0%, #10b981 100%);">
                                        {{ solicitud.fecha_solicitud }}
                                    </span>
                                {% else %}
                                    <span class="text-muted">Sin Fecha</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if solicitud.fecha_recepcion %}
                                    <span class="badge rounded-pill" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                        {{ solicitud.fecha_recepcion }}
                                    </span>
                                {% else %}
                                    <span class="text-muted">Sin Fecha</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="text-wrap" style="max-width: 150px;">
                                    <span class="text-dark">{{ solicitud.descripcion }}</span>
                                </div>
                            </td>
                            <td class="text-center">
                                {% if solicitud.link_solicitud %}
                                    <a href="{{ solicitud.link_solicitud }}" target="_blank" class="btn btn-sm btn-outline-warning rounded-pill" title="Ver en Drive" style="border-color: #ffc107; color: #856404;">
                                        <i class="fas fa-folder" style="color: #ffc107;"></i>
                                    </a>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if solicitud.fecha_solicitud and solicitud.fecha_recepcion %}
                                    <span class="badge rounded-pill" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                        Completado
                                    </span>
                                {% elif solicitud.fecha_solicitud %}
                                    <span class="badge rounded-pill" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                        En Proceso
                                    </span>
                                {% else %}
                                    <span class="badge rounded-pill" style="background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);">
                                        Pendiente
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="d-flex gap-1 justify-content-center">
                                    <button type="button" class="btn btn-sm btn-outline-primary rounded-pill" title="Ver Detalles" 
                                            data-bs-toggle="modal" data-bs-target="#detailSolicitudModal{{ solicitud.pk }}">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-warning rounded-pill" title="Editar Solicitud" 
                                            data-bs-toggle="modal" data-bs-target="#editSolicitudModal{{ solicitud.pk }}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-danger rounded-pill" title="Eliminar Solicitud" 
                                            data-bs-toggle="modal" data-bs-target="#deleteSolicitudModal{{ solicitud.pk }}">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="10" class="text-center py-5">
                                <div class="text-muted">
                                    <i class="fas fa-file-alt fa-3x mb-3 opacity-50"></i>
                                    <h5 class="fw-semibold">No se encontraron solicitudes</h5>
                                    <p class="mb-0">No hay solicitudes que coincidan con los criterios de búsqueda.</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Crear Solicitud -->
<div class="modal fade" id="createSolicitudModal" tabindex="-1" aria-labelledby="createSolicitudModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <!-- Modal Header -->
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 16px 16px 0 0;">
                <div class="d-flex align-items-center gap-3">
                    <div class="modal-icon">
                        <i class="fas fa-file-alt text-white"></i>
                    </div>
                    <div>
                        <h5 class="modal-title text-white fw-bold mb-0" id="createSolicitudModalLabel">
                            Nueva Solicitud
                        </h5>
                        <p class="text-white-50 mb-0 small">Complete el formulario para registrar una nueva solicitud</p>
                    </div>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <!-- Modal Body -->
            <div class="modal-body p-4">
                <form method="post" action="{% url 'solicitud-create' %}" enctype="multipart/form-data" novalidate id="createSolicitudForm">
                    {% csrf_token %}
                    
                    <!-- Primera fila: Solicitante y Documento -->
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_solicitante" class="form-label fw-semibold text-dark">
                                    <i class="fas fa-user text-primary me-2"></i>Solicitante
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" name="solicitante" id="id_solicitante" class="form-control modal-input" required>
                                    <div class="input-focus-border"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_nombre_documento" class="form-label fw-semibold text-dark">
                                    <i class="fas fa-file-alt text-primary me-2"></i>Nombre del Documento
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" name="nombre_documento" id="id_nombre_documento" class="form-control modal-input" required>
                                    <div class="input-focus-border"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Segunda fila: Nombre y Dirección -->
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_nombre" class="form-label fw-semibold text-dark">
                                    <i class="fas fa-tag text-primary me-2"></i>Nombre
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" name="nombre" id="id_nombre" class="form-control modal-input" required>
                                    <div class="input-focus-border"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_direccion" class="form-label fw-semibold text-dark">
                                    <i class="fas fa-map-marker-alt text-primary me-2"></i>Dirección
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" name="direccion" id="id_direccion" class="form-control modal-input" required>
                                    <div class="input-focus-border"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tercera fila: Fechas -->
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_fecha_solicitud" class="form-label fw-semibold text-dark">
                                    <i class="fas fa-calendar-plus text-primary me-2"></i>Fecha de Solicitud
                                </label>
                                <div class="input-wrapper">
                                    <input type="date" name="fecha_solicitud" id="id_fecha_solicitud" class="form-control modal-input">
                                    <div class="input-focus-border"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="id_fecha_recepcion" class="form-label fw-semibold text-dark">
                                    <i class="fas fa-calendar-check text-primary me-2"></i>Fecha de Recepción
                                </label>
                                <div class="input-wrapper">
                                    <input type="date" name="fecha_recepcion" id="id_fecha_recepcion" class="form-control modal-input">
                                    <div class="input-focus-border"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Descripción -->
                    <div class="form-group mb-3">
                        <label for="id_descripcion" class="form-label fw-semibold text-dark">
                            <i class="fas fa-align-left text-primary me-2"></i>Descripción
                        </label>
                        <div class="input-wrapper">
                            <textarea name="descripcion" id="id_descripcion" class="form-control modal-input" rows="3" placeholder="Descripción detallada de la solicitud..."></textarea>
                            <div class="input-focus-border"></div>
                        </div>
                    </div>

                    <!-- Enlace de Drive -->
                    <div class="form-group mb-3">
                        <label for="id_link_solicitud" class="form-label fw-semibold text-dark">
                            <i class="fas fa-link text-primary me-2"></i>Enlace de Drive
                        </label>
                        <div class="input-wrapper">
                            <input type="url" name="link_solicitud" id="id_link_solicitud" class="form-control modal-input" placeholder="https://drive.google.com/...">
                            <div class="input-focus-border"></div>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Modal Footer -->
            <div class="modal-footer border-0 pt-0">
                <div class="d-flex gap-2 w-100">
                    <button type="button" class="btn btn-secondary modal-btn" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <button type="submit" form="createSolicitudForm" class="btn btn-primary modal-btn">
                        <i class="fas fa-save me-2"></i>Crear Solicitud
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modales para cada solicitud -->
{% for solicitud in solicitudes %}
    <!-- Modal de Detalles -->
    <div class="modal fade" id="detailSolicitudModal{{ solicitud.pk }}" tabindex="-1" aria-labelledby="detailSolicitudModalLabel{{ solicitud.pk }}" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <!-- Modal Header -->
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 16px 16px 0 0;">
                    <div class="d-flex align-items-center gap-3">
                        <div class="modal-icon">
                            <i class="fas fa-eye text-white"></i>
                        </div>
                        <div>
                            <h5 class="modal-title text-white fw-bold mb-0" id="detailSolicitudModalLabel{{ solicitud.pk }}">
                                Detalles de Solicitud
                            </h5>
                            <p class="text-white-50 mb-0 small">{{ solicitud.nombre }}</p>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Modal Body -->
                <div class="modal-body p-4">
                    <div class="row g-4">
                        <!-- Información Principal -->
                        <div class="col-md-6">
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="fas fa-user text-primary"></i>
                                </div>
                                <div class="detail-content">
                                    <h6 class="detail-label">Solicitante</h6>
                                    <p class="detail-value">{{ solicitud.solicitante|default:"No especificado" }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="fas fa-file-alt text-primary"></i>
                                </div>
                                <div class="detail-content">
                                    <h6 class="detail-label">Documento</h6>
                                    <p class="detail-value">{{ solicitud.nombre_documento|default:"No especificado" }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="fas fa-tag text-primary"></i>
                                </div>
                                <div class="detail-content">
                                    <h6 class="detail-label">Nombre</h6>
                                    <p class="detail-value">{{ solicitud.nombre|default:"No especificado" }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="fas fa-map-marker-alt text-primary"></i>
                                </div>
                                <div class="detail-content">
                                    <h6 class="detail-label">Dirección</h6>
                                    <p class="detail-value">{{ solicitud.direccion|default:"No especificado" }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="fas fa-calendar-plus text-primary"></i>
                                </div>
                                <div class="detail-content">
                                    <h6 class="detail-label">Fecha de Solicitud</h6>
                                    <p class="detail-value">{{ solicitud.fecha_solicitud|default:"No especificada" }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="fas fa-calendar-check text-primary"></i>
                                </div>
                                <div class="detail-content">
                                    <h6 class="detail-label">Fecha de Recepción</h6>
                                    <p class="detail-value">{{ solicitud.fecha_recepcion|default:"No especificada" }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Estado -->
                        <div class="col-12">
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="fas fa-flag text-primary"></i>
                                </div>
                                <div class="detail-content">
                                    <h6 class="detail-label">Estado</h6>
                                    {% if solicitud.fecha_solicitud and solicitud.fecha_recepcion %}
                                        <span class="badge rounded-pill" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                            Completado
                                        </span>
                                    {% elif solicitud.fecha_solicitud %}
                                        <span class="badge rounded-pill" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                            En Proceso
                                        </span>
                                    {% else %}
                                        <span class="badge rounded-pill" style="background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);">
                                            Pendiente
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Descripción -->
                        {% if solicitud.descripcion %}
                        <div class="col-12">
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="fas fa-align-left text-primary"></i>
                                </div>
                                <div class="detail-content">
                                    <h6 class="detail-label">Descripción</h6>
                                    <p class="detail-value">{{ solicitud.descripcion }}</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Enlace de Drive -->
                        {% if solicitud.link_solicitud %}
                        <div class="col-12">
                            <div class="detail-card">
                                <div class="detail-icon">
                                    <i class="fas fa-link text-primary"></i>
                                </div>
                                <div class="detail-content">
                                    <h6 class="detail-label">Enlace de Drive</h6>
                                    <a href="{{ solicitud.link_solicitud }}" target="_blank" class="btn btn-sm btn-outline-warning">
                                        <i class="fas fa-external-link-alt me-2"></i>Ver en Drive
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="modal-footer border-0 pt-0">
                    <div class="d-flex gap-2 w-100">
                        <button type="button" class="btn btn-secondary modal-btn" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>Cerrar
                        </button>
                        <button type="button" class="btn btn-warning modal-btn" data-bs-toggle="modal" data-bs-target="#editSolicitudModal{{ solicitud.pk }}" data-bs-dismiss="modal">
                            <i class="fas fa-edit me-2"></i>Editar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edición -->
    <div class="modal fade" id="editSolicitudModal{{ solicitud.pk }}" tabindex="-1" aria-labelledby="editSolicitudModalLabel{{ solicitud.pk }}" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <!-- Modal Header -->
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 16px 16px 0 0;">
                    <div class="d-flex align-items-center gap-3">
                        <div class="modal-icon">
                            <i class="fas fa-edit text-white"></i>
                        </div>
                        <div>
                            <h5 class="modal-title text-white fw-bold mb-0" id="editSolicitudModalLabel{{ solicitud.pk }}">
                                Editar Solicitud
                            </h5>
                            <p class="text-white-50 mb-0 small">{{ solicitud.nombre }}</p>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Modal Body -->
                <div class="modal-body p-4">
                    <form method="post" action="{% url 'solicitud-update' solicitud.pk %}" id="editSolicitudForm{{ solicitud.pk }}">
                        {% csrf_token %}
                        
                        <!-- Primera fila: Solicitante y Documento -->
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="edit_solicitante_{{ solicitud.pk }}" class="form-label fw-semibold text-dark">
                                        <i class="fas fa-user text-primary me-2"></i>Solicitante
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="text" name="solicitante" id="edit_solicitante_{{ solicitud.pk }}" 
                                               class="form-control modal-input" value="{{ solicitud.solicitante }}" required>
                                        <div class="input-focus-border"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="edit_nombre_documento_{{ solicitud.pk }}" class="form-label fw-semibold text-dark">
                                        <i class="fas fa-file-alt text-primary me-2"></i>Nombre del Documento
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="text" name="nombre_documento" id="edit_nombre_documento_{{ solicitud.pk }}" 
                                               class="form-control modal-input" value="{{ solicitud.nombre_documento }}" required>
                                        <div class="input-focus-border"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Segunda fila: Nombre y Dirección -->
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="edit_nombre_{{ solicitud.pk }}" class="form-label fw-semibold text-dark">
                                        <i class="fas fa-tag text-primary me-2"></i>Nombre
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="text" name="nombre" id="edit_nombre_{{ solicitud.pk }}" 
                                               class="form-control modal-input" value="{{ solicitud.nombre }}" required>
                                        <div class="input-focus-border"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="edit_direccion_{{ solicitud.pk }}" class="form-label fw-semibold text-dark">
                                        <i class="fas fa-map-marker-alt text-primary me-2"></i>Dirección
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="text" name="direccion" id="edit_direccion_{{ solicitud.pk }}" 
                                               class="form-control modal-input" value="{{ solicitud.direccion }}" required>
                                        <div class="input-focus-border"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tercera fila: Fechas -->
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="edit_fecha_solicitud_{{ solicitud.pk }}" class="form-label fw-semibold text-dark">
                                        <i class="fas fa-calendar-plus text-primary me-2"></i>Fecha de Solicitud
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="date" name="fecha_solicitud" id="edit_fecha_solicitud_{{ solicitud.pk }}" 
                                               class="form-control modal-input" value="{{ solicitud.fecha_solicitud }}">
                                        <div class="input-focus-border"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="edit_fecha_recepcion_{{ solicitud.pk }}" class="form-label fw-semibold text-dark">
                                        <i class="fas fa-calendar-check text-primary me-2"></i>Fecha de Recepción
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="date" name="fecha_recepcion" id="edit_fecha_recepcion_{{ solicitud.pk }}" 
                                               class="form-control modal-input" value="{{ solicitud.fecha_recepcion }}">
                                        <div class="input-focus-border"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Descripción -->
                        <div class="form-group mb-3">
                            <label for="edit_descripcion_{{ solicitud.pk }}" class="form-label fw-semibold text-dark">
                                <i class="fas fa-align-left text-primary me-2"></i>Descripción
                            </label>
                            <div class="input-wrapper">
                                <textarea name="descripcion" id="edit_descripcion_{{ solicitud.pk }}" 
                                          class="form-control modal-input" rows="3" placeholder="Descripción detallada de la solicitud...">{{ solicitud.descripcion }}</textarea>
                                <div class="input-focus-border"></div>
                            </div>
                        </div>

                        <!-- Enlace de Drive -->
                        <div class="form-group mb-3">
                            <label for="edit_link_solicitud_{{ solicitud.pk }}" class="form-label fw-semibold text-dark">
                                <i class="fas fa-link text-primary me-2"></i>Enlace de Drive
                            </label>
                            <div class="input-wrapper">
                                <input type="url" name="link_solicitud" id="edit_link_solicitud_{{ solicitud.pk }}" 
                                       class="form-control modal-input" placeholder="https://drive.google.com/..." value="{{ solicitud.link_solicitud }}">
                                <div class="input-focus-border"></div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Modal Footer -->
                <div class="modal-footer border-0 pt-0">
                    <div class="d-flex gap-2 w-100">
                        <button type="button" class="btn btn-secondary modal-btn" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>Cancelar
                        </button>
                        <button type="submit" form="editSolicitudForm{{ solicitud.pk }}" class="btn btn-primary modal-btn">
                            <i class="fas fa-save me-2"></i>Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Eliminación -->
    <div class="modal fade" id="deleteSolicitudModal{{ solicitud.pk }}" tabindex="-1" aria-labelledby="deleteSolicitudModalLabel{{ solicitud.pk }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <!-- Modal Header -->
                <div class="modal-header" style="background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); border: none; border-radius: 16px 16px 0 0;">
                    <div class="d-flex align-items-center gap-3">
                        <div class="modal-icon">
                            <i class="fas fa-exclamation-triangle text-white"></i>
                        </div>
                        <div>
                            <h5 class="modal-title text-white fw-bold mb-0" id="deleteSolicitudModalLabel{{ solicitud.pk }}">
                                Confirmar Eliminación
                            </h5>
                            <p class="text-white-50 mb-0 small">Esta acción no se puede deshacer</p>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Modal Body -->
                <div class="modal-body p-4 text-center">
                    <div class="delete-warning">
                        <i class="fas fa-trash-alt fa-3x text-danger mb-3"></i>
                        <h5 class="fw-bold text-dark mb-3">¿Estás seguro de eliminar esta solicitud?</h5>
                        <div class="solicitud-info p-3 bg-light rounded">
                            <p class="mb-1"><strong>Solicitante:</strong> {{ solicitud.solicitante }}</p>
                            <p class="mb-1"><strong>Documento:</strong> {{ solicitud.nombre_documento }}</p>
                            <p class="mb-0"><strong>Nombre:</strong> {{ solicitud.nombre }}</p>
                        </div>
                        <p class="text-muted mt-3">Esta acción eliminará permanentemente la solicitud y todos sus datos asociados.</p>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="modal-footer border-0 pt-0">
                    <div class="d-flex gap-2 w-100">
                        <button type="button" class="btn btn-secondary modal-btn" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>Cancelar
                        </button>
                        <form method="post" action="{% url 'solicitud-delete' solicitud.pk %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger modal-btn">
                                <i class="fas fa-trash-alt me-2"></i>Eliminar Definitivamente
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endfor %}

<style>
    /* Professional Design Improvements */
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
    }
    
    /* FontAwesome Icon Styles */
    .fa-solid, .fas, .fa {
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
        display: inline-block;
        font-style: normal;
        font-variant: normal;
        text-rendering: auto;
        line-height: 1;
    }
    
    .fa-lg {
        font-size: 1.33333em;
        line-height: 0.75em;
        vertical-align: -0.0667em;
    }
    
    /* Card Icon Styles */
    .card .bg-white.bg-opacity-25 {
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .card .bg-white.bg-opacity-25:hover {
        transform: scale(1.1);
        background: rgba(255, 255, 255, 0.4) !important;
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    
    .card .bg-white.bg-opacity-25 i {
        font-size: 1.5rem;
        color: white !important;
        text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
    }
    
    /* Card Enhancements */
    .card {
        border-radius: 12px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(0,0,0,0.15) !important;
    }
    
    /* Statistics Cards Specific Styles */
    .row.g-3 .card {
        border: none;
        overflow: hidden;
        position: relative;
    }
    
    .row.g-3 .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        pointer-events: none;
    }
    
    .row.g-3 .card .card-body {
        position: relative;
        z-index: 1;
    }
    
    /* Table Improvements */
    .table {
        font-size: 0.875rem;
        border-collapse: separate;
        border-spacing: 0;
    }
    
    .table thead th {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: none;
        padding: 1rem 0.75rem;
        font-weight: 600;
        color: #495057;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    .table tbody tr {
        transition: all 0.2s ease;
    }
    
    .table tbody tr:hover {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        transform: scale(1.001);
    }
    
    .table td {
        padding: 1rem 0.75rem;
        vertical-align: middle;
        border: none;
        border-bottom: 1px solid #f1f3f4;
    }
    
    /* Badge Improvements */
    .badge {
        font-weight: 500;
        padding: 0.5em 0.75em;
        font-size: 0.75rem;
    }
    
    /* Button Improvements */
    .btn {
        font-weight: 500;
        border-radius: 8px;
        transition: all 0.3s ease;
        border: none;
    }
    
    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .btn-outline-primary {
        border: 2px solid #007bff;
        color: #007bff;
    }
    
    .btn-outline-primary:hover {
        background: #007bff;
        border-color: #007bff;
    }
    
    .btn-outline-warning {
        border: 2px solid #ffc107;
        color: #ffc107;
    }
    
    .btn-outline-warning:hover {
        background: #ffc107;
        border-color: #ffc107;
        color: #000;
    }
    
    .btn-outline-danger {
        border: 2px solid #dc3545;
        color: #dc3545;
    }
    
    .btn-outline-danger:hover {
        background: #dc3545;
        border-color: #dc3545;
    }
    
    .btn-outline-success {
        border: 2px solid #28a745;
        color: #28a745;
    }
    
    .btn-outline-success:hover {
        background: #28a745;
        border-color: #28a745;
    }
    
    /* Avatar Styles */
    .avatar {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .avatar-initial {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        font-weight: 600;
    }
    
    /* Estilos elegantes para la sección de filtros */
    .filters-container {
        margin-bottom: 2rem;
    }
    
    .filters-card {
        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.02);
        border: 1px solid rgba(226, 232, 240, 0.6);
        overflow: hidden;
        position: relative;
        backdrop-filter: blur(10px);
    }
    
    .filters-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        opacity: 0.8;
    }
    
    .filters-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 1.5rem 2rem;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        overflow: hidden;
    }
    
    .filters-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        pointer-events: none;
    }
    
    .filters-title {
        display: flex;
        align-items: center;
        gap: 1rem;
        position: relative;
        z-index: 1;
    }
    
    .title-icon {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .title-icon i {
        font-size: 1.25rem;
        color: white;
        opacity: 0.95;
    }
    
    .title-content {
        flex: 1;
    }
    
    .title-text {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
        letter-spacing: -0.3px;
    }
    
    .title-subtitle {
        font-size: 0.85rem;
        opacity: 0.85;
        margin: 0.2rem 0 0 0;
        font-weight: 400;
        letter-spacing: 0.2px;
    }
    
    .filters-actions {
        position: relative;
        z-index: 1;
    }
    
    .active-filters {
        background: rgba(255, 255, 255, 0.12);
        border-radius: 10px;
        padding: 0.6rem 1rem;
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }
    
    .filter-count {
        background: rgba(255, 255, 255, 0.9);
        color: #667eea;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .filter-status-label {
        font-size: 0.85rem;
        font-weight: 500;
        color: white;
    }
    
    .filters-body {
        padding: 1.75rem 2rem;
    }
    
    .filters-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr 1.5fr;
        gap: 1.25rem;
        align-items: end;
    }
    
    .filter-item {
        position: relative;
    }
    
    .filter-label {
        font-size: 0.75rem;
        font-weight: 500;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.4px;
        margin-bottom: 0.4rem;
        display: block;
    }
    
    .filter-input-wrapper {
        position: relative;
        background: #ffffff;
        border-radius: 10px;
        border: 1.5px solid #e2e8f0;
        transition: all 0.25s ease;
        overflow: hidden;
    }
    
    .filter-input-wrapper:hover {
        border-color: #cbd5e1;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
        transform: translateY(-1px);
    }
    
    .filter-input-wrapper:focus-within {
        border-color: #667eea;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.08);
        transform: translateY(-1px);
    }
    
    .input-icon {
        position: absolute;
        left: 0.875rem;
        top: 50%;
        transform: translateY(-50%);
        color: #94a3b8;
        z-index: 2;
        transition: color 0.25s ease;
        font-size: 0.9rem;
    }
    
    .filter-input-wrapper:focus-within .input-icon {
        color: #667eea;
    }
    
    .filter-input {
        width: 100%;
        padding: 0.875rem 1rem 0.875rem 2.75rem;
        border: none;
        background: transparent;
        font-size: 0.9rem;
        color: #1e293b;
        outline: none;
        transition: all 0.25s ease;
    }
    
    .filter-input::placeholder {
        color: #94a3b8;
        font-weight: 400;
    }
    
    .search-filter .filter-input-wrapper {
        background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        border-color: #e2e8f0;
    }
    
    .search-filter .filter-input-wrapper:focus-within {
        background: #ffffff;
        border-color: #667eea;
    }
    
    .input-focus-border {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.25s ease;
    }
    
    .filter-input-wrapper:focus-within .input-focus-border {
        width: 100%;
    }
    
    .filter-actions {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
    }
    
    .btn-primary, .btn-secondary {
        padding: 0.875rem 1.25rem;
        border: none;
        border-radius: 10px;
        font-weight: 500;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        transition: all 0.25s ease;
        text-decoration: none;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
    }
    
    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        color: white;
    }
    
    .btn-secondary {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        color: #64748b;
        border: 1.5px solid #e2e8f0;
    }
    
    .btn-secondary:hover {
        transform: translateY(-1px);
        box-shadow: 0 3px 12px rgba(0, 0, 0, 0.08);
        color: #475569;
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    }
    
    /* Responsive para filtros elegantes */
    @media (max-width: 1200px) {
        .filters-grid {
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .search-filter {
            grid-column: 1 / -1;
        }
        
        .actions-filter {
            grid-column: 1 / -1;
        }
        
        .filter-actions {
            flex-direction: row;
            justify-content: center;
        }
    }
    
    @media (max-width: 768px) {
        .filters-header {
            padding: 1.5rem;
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }
        
        .filters-title {
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .title-icon {
            width: 50px;
            height: 50px;
        }
        
        .title-text {
            font-size: 1.25rem;
        }
        
        .filters-body {
            padding: 1.5rem;
        }
        
        .filters-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .filter-actions {
            flex-direction: column;
        }
        
        .btn-primary, .btn-secondary {
            padding: 0.875rem 1.25rem;
            font-size: 0.85rem;
        }
    }
    
    /* Responsive Improvements */
    @media (max-width: 768px) {
        .table {
            font-size: 0.75rem;
        }
        
        .btn {
            padding: 0.375rem 0.5rem;
            font-size: 0.75rem;
        }
        
        .card-body {
            padding: 1rem !important;
        }
        
        .h3 {
            font-size: 1.5rem;
        }
        
        .h6 {
            font-size: 0.875rem;
        }
        
        .avatar {
            width: 32px;
            height: 32px;
        }
        
        .avatar-initial {
            font-size: 0.875rem;
        }
    }
    
    /* Smooth scrolling */
    .table-responsive {
        -webkit-overflow-scrolling: touch;
        border-radius: 12px;
    }
    
    /* Loading animation for empty state */
    .opacity-50 {
        opacity: 0.5;
    }
    
    /* Professional shadows */
    .shadow-sm {
        box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
    }
    
    /* Text improvements */
    .text-dark {
        color: #212529 !important;
    }
    
    .fw-semibold {
        font-weight: 600 !important;
    }
    
    .fw-medium {
        font-weight: 500 !important;
    }
    
    /* Modal Styles */
    .modal-content {
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    }
    
    .modal-header {
        position: relative;
        overflow: hidden;
    }
    
    .modal-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        pointer-events: none;
    }
    
    .modal-icon {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .modal-icon i {
        font-size: 1.25rem;
        color: white;
        opacity: 0.95;
    }
    
    .modal-body {
        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
    }
    
    .modal-input {
        border: 1.5px solid #e2e8f0;
        border-radius: 10px;
        padding: 0.875rem 1rem;
        font-size: 0.9rem;
        transition: all 0.25s ease;
        background: #ffffff;
    }
    
    .modal-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.08);
        outline: none;
    }
    
    .modal-input::placeholder {
        color: #94a3b8;
        font-weight: 400;
    }
    
    .input-wrapper {
        position: relative;
    }
    
    .input-focus-border {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.25s ease;
    }
    
    .input-wrapper:focus-within .input-focus-border {
        width: 100%;
    }
    
    .modal-btn {
        padding: 0.875rem 1.5rem;
        border-radius: 10px;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.25s ease;
        border: none;
    }
    
    .modal-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .btn-primary.modal-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
    }
    
    .btn-primary.modal-btn:hover {
        background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        color: white;
    }
    
    .btn-secondary.modal-btn {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        color: #64748b;
        border: 1.5px solid #e2e8f0;
    }
    
    .btn-secondary.modal-btn:hover {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        color: #475569;
    }
    
    /* Form validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.08);
    }
    
    .form-control.is-valid {
        border-color: #28a745;
        box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.08);
    }
    
    .invalid-feedback {
        color: #dc3545;
        font-size: 0.8rem;
        margin-top: 0.25rem;
    }
    
    .valid-feedback {
        color: #28a745;
        font-size: 0.8rem;
        margin-top: 0.25rem;
    }
    
    /* Modal animation improvements */
    .modal.fade .modal-dialog {
        transition: transform 0.3s ease-out;
        transform: translate(0, -50px) scale(0.95);
    }
    
    .modal.show .modal-dialog {
        transform: translate(0, 0) scale(1);
    }
    
    /* Responsive modal */
    @media (max-width: 768px) {
        .modal-dialog {
            margin: 1rem;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-header {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1.5rem;
        }
    }
    
    /* Detail Card Styles */
    .detail-card {
        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 1.25rem;
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        transition: all 0.25s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .detail-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        border-color: #cbd5e1;
    }
    
    .detail-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .detail-icon i {
        font-size: 1.25rem;
        color: white;
    }
    
    .detail-content {
        flex: 1;
    }
    
    .detail-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.4px;
        margin-bottom: 0.5rem;
    }
    
    .detail-value {
        font-size: 0.95rem;
        font-weight: 500;
        color: #1e293b;
        margin-bottom: 0;
        line-height: 1.4;
    }
    
    /* Delete Warning Styles */
    .delete-warning {
        padding: 1rem;
    }
    
    .solicitud-info {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        margin: 1rem 0;
    }
    
    .solicitud-info p {
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }
    
    .solicitud-info p:last-child {
        margin-bottom: 0;
    }
    
    /* Button Enhancements */
    .btn-warning.modal-btn {
        background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        color: white;
        border: none;
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);
    }
    
    .btn-warning.modal-btn:hover {
        background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }
    
    .btn-danger.modal-btn {
        background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        color: white;
        border: none;
        box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
    }
    
    .btn-danger.modal-btn:hover {
        background: linear-gradient(135deg, #b91c1c 0%, #dc2626 100%);
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
    }
    
    /* Modal Transition Improvements */
    .modal.fade .modal-dialog {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        transform: translate(0, -60px) scale(0.95);
        opacity: 0;
    }
    
    .modal.show .modal-dialog {
        transform: translateY(0) scale(1);
        opacity: 1;
    }
    
    /* Responsive improvements for detail cards */
    @media (max-width: 768px) {
        .detail-card {
            flex-direction: column;
            text-align: center;
            gap: 0.75rem;
        }
        
        .detail-icon {
            align-self: center;
        }
        
        .modal-dialog {
            margin: 0.5rem;
        }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Función para toggle de filtros
    function toggleFilters() {
        const filtersBody = document.getElementById('filtersBody');
        const iconToggle = document.getElementById('iconToggleFilters');
        const btnToggle = document.getElementById('btnToggleFilters');
        
        if (filtersBody.style.display === 'none') {
            // Expandir
            filtersBody.style.display = 'block';
            iconToggle.className = 'fas fa-chevron-up';
            btnToggle.setAttribute('title', 'Ocultar filtros de búsqueda');
        } else {
            // Colapsar
            filtersBody.style.display = 'none';
            iconToggle.className = 'fas fa-chevron-down';
            btnToggle.setAttribute('title', 'Mostrar filtros de búsqueda');
        }
    }
    
    // Event listener para el botón de toggle de filtros
    const btnToggleFilters = document.getElementById('btnToggleFilters');
    if (btnToggleFilters) {
        btnToggleFilters.addEventListener('click', function(e) {
            e.preventDefault();
            toggleFilters();
        });
    }
    
    // Inicializar DataTable
    if (typeof $.fn.DataTable !== 'undefined') {
        $('#example').DataTable({
            responsive: true,
            language: {
                url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json'
            },
            pageLength: 25,
            order: [[4, 'desc']], // Ordenar por fecha de solicitud descendente
            columnDefs: [
                {
                    targets: [9], // Columna de acciones
                    orderable: false,
                    searchable: false
                }
            ]
        });
    }
    
    // Modal form handling
    const createSolicitudForm = document.getElementById('createSolicitudForm');
    const createSolicitudModal = document.getElementById('createSolicitudModal');
    
    if (createSolicitudForm) {
        createSolicitudForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log('Form submitted');
            console.log('Form action:', createSolicitudForm.action);
            
            // Show loading state
            const submitBtn = document.querySelector('button[form="createSolicitudForm"][type="submit"]');
            if (!submitBtn) {
                console.error('Submit button not found');
                return;
            }
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creando...';
            submitBtn.disabled = true;
            
            // Clear previous errors
            clearFormErrors(createSolicitudForm);
            
            // Submit form via AJAX
            const formData = new FormData(createSolicitudForm);
            
            // Log form data
            for (let [key, value] of formData.entries()) {
                console.log(key + ': ' + value);
            }
            
            console.log('Sending request to:', createSolicitudForm.action);
            
            fetch(createSolicitudForm.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            })
            .then(response => {
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                // Log response text for debugging
                return response.text().then(text => {
                    console.log('Response text:', text);
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        console.error('Failed to parse JSON:', e);
                        throw new Error('Invalid JSON response: ' + text);
                    }
                });
            })
            .then(data => {
                console.log('Response data:', data);
                if (data.success) {
                    // Show success message
                    showNotification('Solicitud creada exitosamente', 'success');
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(createSolicitudModal);
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Reset form
                    createSolicitudForm.reset();
                    
                    // Reload page to show new solicitud
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    // Show error message
                    showNotification(data.message || 'Error al crear la solicitud', 'error');
                    
                    // Display form errors if any
                    if (data.errors) {
                        displayFormErrors(data.errors, null, createSolicitudForm);
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error de conexión: ' + error.message, 'error');
            })
            .finally(() => {
                // Reset button state
                if (submitBtn) {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });
        });
    }
    
    // Function to show notifications
    function showNotification(message, type) {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    }
    
    // Function to clear form errors
    function clearFormErrors(form) {
        const scope = form || document;
        scope.querySelectorAll('.is-invalid').forEach(el => {
            el.classList.remove('is-invalid');
        });
        scope.querySelectorAll('.invalid-feedback').forEach(el => {
            el.remove();
        });
    }
    
    // Function to display form errors
    function displayFormErrors(errors, formId = null, formElement = null) {
        const scope = formElement || document;
        
        // Clear previous errors
        clearFormErrors(scope);
        
        // Display new errors
        Object.keys(errors).forEach(fieldName => {
            let field;
            if (formId && formId.startsWith('editSolicitudForm')) {
                // For edit forms, use the specific field ID
                const solicitudId = formId.replace('editSolicitudForm', '');
                field = document.getElementById(`edit_${fieldName}_${solicitudId}`);
            } else {
                // For create form, use the standard field ID
                field = document.getElementById(`id_${fieldName}`);
            }
            
            if (field) {
                field.classList.add('is-invalid');
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'invalid-feedback';
                errorDiv.textContent = Array.isArray(errors[fieldName]) ? errors[fieldName].join(', ') : errors[fieldName];
                
                field.parentNode.appendChild(errorDiv);
            }
        });
    }
    
    // Reset form when modal is closed
    if (createSolicitudModal) {
        createSolicitudModal.addEventListener('hidden.bs.modal', function() {
            createSolicitudForm.reset();
            
            // Clear validation states
            document.querySelectorAll('.is-invalid').forEach(el => {
                el.classList.remove('is-invalid');
            });
            document.querySelectorAll('.invalid-feedback').forEach(el => {
                el.remove();
            });
        });
    }
    
    // Handle edit forms
    document.querySelectorAll('[id^="editSolicitudForm"]').forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log('Edit form submitted');
            console.log('Form action:', form.action);
            console.log('Form ID:', form.id);
            
            // Show loading state
            const submitBtn = document.querySelector(`button[form="${form.id}"][type="submit"]`);
            if (!submitBtn) {
                console.error('Submit button not found for form:', form.id);
                return;
            }
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Guardando...';
            submitBtn.disabled = true;
            
            // Clear previous errors
            clearFormErrors(form);
            
            // Submit form via AJAX
            const formData = new FormData(form);
            
            // Log form data
            for (let [key, value] of formData.entries()) {
                console.log(key + ': ' + value);
            }
            
            console.log('Sending edit request to:', form.action);
            
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            })
            .then(response => {
                console.log('Edit response status:', response.status);
                console.log('Edit response headers:', response.headers);
                
                // Log response text for debugging
                return response.text().then(text => {
                    console.log('Edit response text:', text);
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        console.error('Failed to parse JSON:', e);
                        throw new Error('Invalid JSON response: ' + text);
                    }
                });
            })
            .then(data => {
                console.log('Edit response data:', data);
                if (data.success) {
                    // Show success message
                    showNotification('Solicitud actualizada exitosamente', 'success');
                    
                    // Close modal
                    const modalId = form.id.replace('editSolicitudForm', 'editSolicitudModal');
                    const modal = bootstrap.Modal.getInstance(document.getElementById(modalId));
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Reload page to show updated data
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    // Show error message
                    showNotification(data.message || 'Error al actualizar la solicitud', 'error');
                    
                    // Display form errors if any
                    if (data.errors) {
                        displayFormErrors(data.errors, form.id, form);
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error de conexión: ' + error.message, 'error');
            })
            .finally(() => {
                // Reset button state
                if (submitBtn) {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });
        });
    });
    
    // Handle delete forms
    document.querySelectorAll('form[action*="eliminar"]').forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show loading state
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Eliminando...';
            submitBtn.disabled = true;
            
            // Submit form via AJAX
            const formData = new FormData(form);
            
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Show success message
                    showNotification('Solicitud eliminada exitosamente', 'success');
                    
                    // Close modal
                    const modalId = form.closest('.modal').id;
                    const modal = bootstrap.Modal.getInstance(document.getElementById(modalId));
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Reload page to show updated data
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    // Show error message
                    showNotification(data.message || 'Error al eliminar la solicitud', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error de conexión', 'error');
            })
            .finally(() => {
                // Reset button state
                if (submitBtn) {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });
        });
    });
    
});
</script>
{% endblock %}